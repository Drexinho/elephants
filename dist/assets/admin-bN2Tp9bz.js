import{g as y,u as z,c as O,s as k,l as N,b as A,d as F}from"./posts-7GkFicWg.js";const S=document.getElementById("login-screen"),E=document.getElementById("admin-content"),_=document.getElementById("login-form"),d=document.getElementById("login-error"),I=document.getElementById("logout-btn"),f=document.getElementById("admin-user");function C(n){S.classList.add("hidden"),E.classList.remove("hidden"),I.classList.remove("hidden"),f.textContent=n||"admin",f.classList.remove("hidden")}function l(){S.classList.remove("hidden"),E.classList.add("hidden"),I.classList.add("hidden"),f.classList.add("hidden"),d.classList.add("hidden")}async function L(){await N(),typeof m=="function"&&m()}async function $(){try{const n=await fetch("/api/me",{credentials:"include"});if(n.ok){const e=await n.json();C(e.user),await L();return}}catch{}l()}$();_.addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("login-user").value.trim(),t=document.getElementById("login-password").value;d.classList.add("hidden");try{const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:e,password:t}),credentials:"include"}),a=await s.json().catch(()=>({}));s.ok&&a.ok?(C(a.user),await L()):(d.textContent=a.error||(s.status===429?"Příliš mnoho pokusů. Zkuste to později.":"Nesprávné přihlašovací údaje."),d.classList.remove("hidden"))}catch{d.textContent="Nesprávné přihlašovací údaje.",d.classList.remove("hidden")}});I.addEventListener("click",async()=>{try{await fetch("/api/logout",{method:"POST",credentials:"include"})}catch{}l()});const P=document.getElementById("post-form"),j=document.getElementById("form-title"),u=document.getElementById("post-id"),D=document.getElementById("title"),c=document.getElementById("date"),T=document.getElementById("excerpt"),U=document.getElementById("body"),b=document.getElementById("image"),w=document.getElementById("cancel-edit"),g=document.getElementById("posts-list");c.value||(c.value=new Date().toISOString().slice(0,10));const r=document.getElementById("image-upload"),h=document.getElementById("image-upload-btn"),o=document.getElementById("image-upload-status");h.addEventListener("click",()=>r.click());r.addEventListener("change",async()=>{const n=r.files?.[0];if(n){o.textContent="Nahrávám…",o.classList.remove("hidden"),h.disabled=!0;try{const e=new FormData;e.append("file",n);const t=await fetch("/api/upload",{method:"POST",body:e,credentials:"include"}),s=await t.json();if(!t.ok){t.status===401?l():o.textContent=s.error||"Chyba";return}b.value=s.url,o.textContent="Nahráno",r.value=""}catch{o.textContent="Chyba připojení (spusťte npm run dev)"}finally{h.disabled=!1,setTimeout(()=>o.classList.add("hidden"),3e3)}}});function m(){const n=y().sort((e,t)=>new Date(t.date)-new Date(e.date));g.innerHTML=n.map(e=>`
        <div class="flex items-center justify-between gap-4 rounded-xl border border-primary-200 bg-white p-4 shadow-sm">
          <div class="min-w-0">
            <p class="admin-heading font-semibold truncate">${H(e.title)}</p>
            <p class="text-sm text-primary-500">${new Date(e.date).toLocaleDateString("cs-CZ")}</p>
          </div>
          <div class="flex gap-2 shrink-0">
            <button type="button" class="edit-post px-4 py-2 text-sm bg-primary-100 hover:bg-primary-200 text-primary-800 rounded-lg transition" data-id="${e.id}">Upravit</button>
            <button type="button" class="delete-post px-4 py-2 text-sm bg-red-50 hover:bg-red-100 text-red-700 rounded-lg transition" data-id="${e.id}">Smazat</button>
          </div>
        </div>
      `).join(""),g.querySelectorAll(".edit-post").forEach(e=>{e.addEventListener("click",()=>{const t=A(e.dataset.id);t&&(j.textContent="Upravit příspěvek",u.value=t.id,D.value=t.title,c.value=t.date,T.value=t.excerpt,U.value=t.body,b.value=t.image||"",w.classList.remove("hidden"))})}),g.querySelectorAll(".delete-post").forEach(e=>{e.addEventListener("click",async()=>{if(!confirm("Opravdu smazat tento příspěvek?"))return;const t=F(y(),e.dataset.id),s=await k(t);s.ok?(m(),u.value===e.dataset.id&&x()):s.unauthorized?l():alert(s.error||"Uložení se nezdařilo.")})})}function H(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}function x(){j.textContent="Nový příspěvek",u.value="",P.reset(),c.value=new Date().toISOString().slice(0,10),w.classList.add("hidden")}P.addEventListener("submit",async n=>{n.preventDefault();const e=u.value,t=D.value.trim(),s=c.value,a=T.value.trim(),p=U.value.trim(),B=b.value.trim();if(!t||!s||!a||!p)return;let i=y();e?i=z(i,e,{title:t,date:s,excerpt:a,body:p,image:B}):i=[O({title:t,date:s,excerpt:a,body:p,image:B}),...i];const v=await k(i);v.ok?(m(),x()):v.unauthorized?l():alert(v.error||"Uložení se nezdařilo.")});w.addEventListener("click",x);E.classList.contains("hidden")===!1&&L();
